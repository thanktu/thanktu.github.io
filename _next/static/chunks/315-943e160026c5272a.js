"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[315],{7315:function(t,e,i){i.d(e,{Z:function(){return th}});var s=i(2991);let l={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},n=[l.FILL],r=[l.STROKE],o=[l.BEGIN_PATH],a=[l.CLOSE_PATH];var h=i(8716),d=class{drawCustom(t,e,i,s,l){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,i){}drawFeature(t,e,i){}drawGeometryCollection(t,e,i){}drawLineString(t,e,i){}drawMultiLineString(t,e,i){}drawMultiPoint(t,e,i){}drawMultiPolygon(t,e,i){}drawPoint(t,e,i){}drawPolygon(t,e,i){}drawText(t,e,i){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}},g=i(6620),u=i(8641),_=i(147),c=i(5537),f=i(9241),x=class extends d{constructor(t,e,i,s){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=s,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){let e=this.pixelRatio;return 1==e?t:t.map(function(t){return t*e})}appendFlatPointCoordinates(t,e){let i=this.getBufferedMaxExtent(),s=this.tmpCoordinate_,l=this.coordinates,n=l.length;for(let r=0,o=t.length;r<o;r+=e)s[0]=t[r],s[1]=t[r+1],(0,u.b8)(i,s)&&(l[n++]=s[0],l[n++]=s[1]);return n}appendFlatLineCoordinates(t,e,i,s,l,n){let r,o,a;let d=this.coordinates,g=d.length,_=this.getBufferedMaxExtent();n&&(e+=s);let c=t[e],f=t[e+1],x=this.tmpCoordinate_,S=!0;for(r=e+s;r<i;r+=s)x[0]=t[r],x[1]=t[r+1],(a=(0,u.pX)(_,x))!==o?(S&&(d[g++]=c,d[g++]=f,S=!1),d[g++]=x[0],d[g++]=x[1]):a===h.Z.INTERSECTING?(d[g++]=x[0],d[g++]=x[1],S=!1):S=!0,c=x[0],f=x[1],o=a;return(l&&S||r===e+s)&&(d[g++]=c,d[g++]=f),g}drawCustomCoordinates_(t,e,i,s,l){for(let n=0,r=i.length;n<r;++n){let r=i[n],o=this.appendFlatLineCoordinates(t,e,r,s,!1,!1);l.push(o),e=r}return e}drawCustom(t,e,i,s,n){let r,o,a,h,d;this.beginGeometry(t,e,n);let g=t.getType(),u=t.getStride(),_=this.coordinates.length;switch(g){case"MultiPolygon":r=t.getOrientedFlatCoordinates(),h=[];let c=t.getEndss();d=0;for(let t=0,e=c.length;t<e;++t){let e=[];d=this.drawCustomCoordinates_(r,d,c[t],u,e),h.push(e)}this.instructions.push([l.CUSTOM,_,h,t,i,f.ug,n]),this.hitDetectionInstructions.push([l.CUSTOM,_,h,t,s||i,f.ug,n]);break;case"Polygon":case"MultiLineString":a=[],r="Polygon"==g?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),d=this.drawCustomCoordinates_(r,0,t.getEnds(),u,a),this.instructions.push([l.CUSTOM,_,a,t,i,f.o1,n]),this.hitDetectionInstructions.push([l.CUSTOM,_,a,t,s||i,f.o1,n]);break;case"LineString":case"Circle":r=t.getFlatCoordinates(),o=this.appendFlatLineCoordinates(r,0,r.length,u,!1,!1),this.instructions.push([l.CUSTOM,_,o,t,i,f.Ml,n]),this.hitDetectionInstructions.push([l.CUSTOM,_,o,t,s||i,f.Ml,n]);break;case"MultiPoint":r=t.getFlatCoordinates(),(o=this.appendFlatPointCoordinates(r,u))>_&&(this.instructions.push([l.CUSTOM,_,o,t,i,f.Ml,n]),this.hitDetectionInstructions.push([l.CUSTOM,_,o,t,s||i,f.Ml,n]));break;case"Point":r=t.getFlatCoordinates(),this.coordinates.push(r[0],r[1]),o=this.coordinates.length,this.instructions.push([l.CUSTOM,_,o,t,i,void 0,n]),this.hitDetectionInstructions.push([l.CUSTOM,_,o,t,s||i,void 0,n])}this.endGeometry(e)}beginGeometry(t,e,i){this.beginGeometryInstruction1_=[l.BEGIN_GEOMETRY,e,0,t,i],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[l.BEGIN_GEOMETRY,e,0,t,i],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){let t,e,i;let s=this.hitDetectionInstructions;s.reverse();let n=s.length,r=-1;for(t=0;t<n;++t)(i=(e=s[t])[0])==l.END_GEOMETRY?r=t:i==l.BEGIN_GEOMETRY&&(e[2]=t,(0,c.FZ)(this.hitDetectionInstructions,r,t),r=-1)}setFillStrokeStyle(t,e){let i=this.state;if(t){let e=t.getColor();i.fillPatternScale=e&&"object"==typeof e&&"src"in e?this.pixelRatio:1,i.fillStyle=(0,g.y)(e||_.bL)}else i.fillStyle=void 0;if(e){let t=e.getColor();i.strokeStyle=(0,g.y)(t||_.Tx);let s=e.getLineCap();i.lineCap=void 0!==s?s:_.mb;let l=e.getLineDash();i.lineDash=l?l.slice():_.X9;let n=e.getLineDashOffset();i.lineDashOffset=n||_.He;let r=e.getLineJoin();i.lineJoin=void 0!==r?r:_.rc;let o=e.getWidth();i.lineWidth=void 0!==o?o:_.yC;let a=e.getMiterLimit();i.miterLimit=void 0!==a?a:_.V4,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0}createFill(t){let e=t.fillStyle,i=[l.SET_FILL_STYLE,e];return"string"!=typeof e&&i.push(t.fillPatternScale),i}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[l.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){let i=t.fillStyle;("string"!=typeof i||t.currentFillStyle!=i)&&(void 0!==i&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)}updateStrokeStyle(t,e){let i=t.strokeStyle,s=t.lineCap,l=t.lineDash,n=t.lineDashOffset,r=t.lineJoin,o=t.lineWidth,a=t.miterLimit;t.currentStrokeStyle==i&&t.currentLineCap==s&&(l==t.currentLineDash||(0,c.fS)(t.currentLineDash,l))&&t.currentLineDashOffset==n&&t.currentLineJoin==r&&t.currentLineWidth==o&&t.currentMiterLimit==a||(void 0!==i&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=s,t.currentLineDash=l,t.currentLineDashOffset=n,t.currentLineJoin=r,t.currentLineWidth=o,t.currentMiterLimit=a)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;let e=[l.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=(0,u.d9)(this.maxExtent),this.maxLineWidth>0)){let t=this.resolution*(this.maxLineWidth+1)/2;(0,u.f3)(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}},S=class extends x{constructor(t,e,i,s){super(t,e,i,s),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e,i){if(!this.image_||this.maxExtent&&!(0,u.b8)(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,e,i);let s=t.getFlatCoordinates(),n=t.getStride(),r=this.coordinates.length,o=this.appendFlatPointCoordinates(s,n);this.instructions.push([l.DRAW_IMAGE,r,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([l.DRAW_IMAGE,r,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e,i){if(!this.image_)return;this.beginGeometry(t,e,i);let s=t.getFlatCoordinates(),n=[];for(let e=0,i=s.length;e<i;e+=t.getStride())(!this.maxExtent||(0,u.b8)(this.maxExtent,s.slice(e,e+2)))&&n.push(s[e],s[e+1]);let r=this.coordinates.length,o=this.appendFlatPointCoordinates(n,2);this.instructions.push([l.DRAW_IMAGE,r,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([l.DRAW_IMAGE,r,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){let i=t.getAnchor(),s=t.getSize(),l=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=s[1],this.opacity_=t.getOpacity(),this.originX_=l[0],this.originY_=l[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=s[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}},p=class extends x{constructor(t,e,i,s){super(t,e,i,s)}drawFlatCoordinates_(t,e,i,s){let n=this.coordinates.length,r=this.appendFlatLineCoordinates(t,e,i,s,!1,!1),o=[l.MOVE_TO_LINE_TO,n,r];return this.instructions.push(o),this.hitDetectionInstructions.push(o),i}drawLineString(t,e,i){let s=this.state,n=s.strokeStyle,a=s.lineWidth;if(void 0===n||void 0===a)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(t,e,i),this.hitDetectionInstructions.push([l.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,_.X9,_.He],o);let h=t.getFlatCoordinates(),d=t.getStride();this.drawFlatCoordinates_(h,0,h.length,d),this.hitDetectionInstructions.push(r),this.endGeometry(e)}drawMultiLineString(t,e,i){let s=this.state,n=s.strokeStyle,a=s.lineWidth;if(void 0===n||void 0===a)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(t,e,i),this.hitDetectionInstructions.push([l.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,_.X9,_.He],o);let h=t.getEnds(),d=t.getFlatCoordinates(),g=t.getStride(),u=0;for(let t=0,e=h.length;t<e;++t)u=this.drawFlatCoordinates_(d,u,h[t],g);this.hitDetectionInstructions.push(r),this.endGeometry(e)}finish(){let t=this.state;return void 0!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&this.instructions.push(r),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){void 0!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(r),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(o)}},m=i(226),y=class extends x{constructor(t,e,i,s){super(t,e,i,s)}drawFlatCoordinatess_(t,e,i,s){let h=this.state,d=void 0!==h.fillStyle,g=void 0!==h.strokeStyle,u=i.length;this.instructions.push(o),this.hitDetectionInstructions.push(o);for(let n=0;n<u;++n){let r=i[n],o=this.coordinates.length,h=this.appendFlatLineCoordinates(t,e,r,s,!0,!g),d=[l.MOVE_TO_LINE_TO,o,h];this.instructions.push(d),this.hitDetectionInstructions.push(d),g&&(this.instructions.push(a),this.hitDetectionInstructions.push(a)),e=r}return d&&(this.instructions.push(n),this.hitDetectionInstructions.push(n)),g&&(this.instructions.push(r),this.hitDetectionInstructions.push(r)),e}drawCircle(t,e,i){let s=this.state,a=s.fillStyle,h=s.strokeStyle;if(void 0===a&&void 0===h)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),void 0!==s.fillStyle&&this.hitDetectionInstructions.push([l.SET_FILL_STYLE,_.bL]),void 0!==s.strokeStyle&&this.hitDetectionInstructions.push([l.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,_.X9,_.He]);let d=t.getFlatCoordinates(),g=t.getStride(),u=this.coordinates.length;this.appendFlatLineCoordinates(d,0,d.length,g,!1,!1);let c=[l.CIRCLE,u];this.instructions.push(o,c),this.hitDetectionInstructions.push(o,c),void 0!==s.fillStyle&&(this.instructions.push(n),this.hitDetectionInstructions.push(n)),void 0!==s.strokeStyle&&(this.instructions.push(r),this.hitDetectionInstructions.push(r)),this.endGeometry(e)}drawPolygon(t,e,i){let s=this.state,n=s.fillStyle,r=s.strokeStyle;if(void 0===n&&void 0===r)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),void 0!==s.fillStyle&&this.hitDetectionInstructions.push([l.SET_FILL_STYLE,_.bL]),void 0!==s.strokeStyle&&this.hitDetectionInstructions.push([l.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,_.X9,_.He]);let o=t.getEnds(),a=t.getOrientedFlatCoordinates(),h=t.getStride();this.drawFlatCoordinatess_(a,0,o,h),this.endGeometry(e)}drawMultiPolygon(t,e,i){let s=this.state,n=s.fillStyle,r=s.strokeStyle;if(void 0===n&&void 0===r)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),void 0!==s.fillStyle&&this.hitDetectionInstructions.push([l.SET_FILL_STYLE,_.bL]),void 0!==s.strokeStyle&&this.hitDetectionInstructions.push([l.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,_.X9,_.He]);let o=t.getEndss(),a=t.getOrientedFlatCoordinates(),h=t.getStride(),d=0;for(let t=0,e=o.length;t<e;++t)d=this.drawFlatCoordinatess_(a,d,o[t],h);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;let t=this.tolerance;if(0!==t){let e=this.coordinates;for(let i=0,s=e.length;i<s;++i)e[i]=(0,m.uZ)(e[i],t)}return super.finish()}setFillStrokeStyles_(){let t=this.state,e=t.fillStyle;void 0!==e&&this.updateFillStyle(t,this.createFill),void 0!==t.strokeStyle&&this.updateStrokeStyle(t,this.applyStroke)}},C=i(4187),T=i(3983);let I={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};var k=class extends x{constructor(t,e,i,s){super(t,e,i,s),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[_.bL]={fillStyle:_.bL},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){let t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e,i){let s=this.textFillState_,n=this.textStrokeState_,r=this.textState_;if(""===this.text_||!r||!s&&!n)return;let o=this.coordinates,a=o.length,h=t.getType(),d=null,g=t.getStride();if("line"===r.placement&&("LineString"==h||"MultiLineString"==h||"Polygon"==h||"MultiPolygon"==h)){let s;if(!(0,u.kK)(this.maxExtent,t.getExtent()))return;if(d=t.getFlatCoordinates(),"LineString"==h)s=[d.length];else if("MultiLineString"==h)s=t.getEnds();else if("Polygon"==h)s=t.getEnds().slice(0,1);else if("MultiPolygon"==h){let e=t.getEndss();s=[];for(let t=0,i=e.length;t<i;++t)s.push(e[t][0])}this.beginGeometry(t,e,i);let l=r.repeat,n=l?void 0:r.textAlign,_=0;for(let t=0,e=s.length;t<e;++t){let e;e=l?function(t,e,i,s,l){let n=[],r=i,o=0,a=e.slice(i,2);for(;o<t&&r+l<s;){let[i,s]=a.slice(-2),h=e[r+l],d=e[r+l+1],g=Math.sqrt((h-i)*(h-i)+(d-s)*(d-s));if((o+=g)>=t){let e=(t-o+g)/g,u=(0,T.t7)(i,h,e),_=(0,T.t7)(s,d,e);a.push(u,_),n.push(a),a=[u,_],o==t&&(r+=l),o=0}else if(o<t)a.push(e[r+l],e[r+l+1]),r+=l;else{let t=g-o,e=(0,T.t7)(i,h,t/g),u=(0,T.t7)(s,d,t/g);a.push(e,u),n.push(a),a=[e,u],o=0,r+=l}}return o>0&&n.push(a),n}(l*this.resolution,d,_,s[t],g):[d.slice(_,s[t])];for(let i=0,l=e.length;i<l;++i){let l=e[i],h=0,d=l.length;if(void 0==n){let t=function(t,e,i,s,l){let n,r,o,a,h,d,g,u,_,c=i,f=i,x=0,S=0,p=i;for(n=i;n<s;n+=l){let i=e[n],s=e[n+1];void 0!==a&&(o=Math.sqrt((u=i-a)*u+(_=s-h)*_),void 0!==d&&(S+=r,Math.acos((d*u+g*_)/(r*o))>t&&(S>x&&(x=S,c=p,f=n),S=0,p=n-l)),r=o,d=u,g=_),a=i,h=s}return(S+=o)>x?[p,n]:[c,f]}(r.maxAngle,l,0,l.length,2);h=t[0],d=t[1]}for(let t=h;t<d;t+=g)o.push(l[t],l[t+1]);let u=o.length;_=s[t],this.drawChars_(a,u),a=u}}this.endGeometry(e)}else{let s=r.overflow?null:[];switch(h){case"Point":case"MultiPoint":d=t.getFlatCoordinates();break;case"LineString":d=t.getFlatMidpoint();break;case"Circle":d=t.getCenter();break;case"MultiLineString":d=t.getFlatMidpoints(),g=2;break;case"Polygon":d=t.getFlatInteriorPoint(),r.overflow||s.push(d[2]/this.resolution),g=3;break;case"MultiPolygon":let n=t.getFlatInteriorPoints();d=[];for(let t=0,e=n.length;t<e;t+=3)r.overflow||s.push(n[t+2]/this.resolution),d.push(n[t],n[t+1]);if(0===d.length)return;g=2}let u=this.appendFlatPointCoordinates(d,g);if(u===a)return;if(s&&(u-a)/2!=d.length/g){let t=a/2;s=s.filter((e,i)=>{let s=o[(t+i)*2]===d[i*g]&&o[(t+i)*2+1]===d[i*g+1];return!s&&--t,s})}this.saveTextStates_(),(r.backgroundFill||r.backgroundStroke)&&(this.setFillStrokeStyle(r.backgroundFill,r.backgroundStroke),r.backgroundFill&&this.updateFillStyle(this.state,this.createFill),r.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e,i);let c=r.padding;if(c!=_.oB&&(r.scale[0]<0||r.scale[1]<0)){let t=r.padding[0],e=r.padding[1],i=r.padding[2],s=r.padding[3];r.scale[0]<0&&(e=-e,s=-s),r.scale[1]<0&&(t=-t,i=-i),c=[t,e,i,s]}let f=this.pixelRatio;this.instructions.push([l.DRAW_IMAGE,a,u,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,c==_.oB?_.oB:c.map(function(t){return t*f}),!!r.backgroundFill,!!r.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,s]);let x=1/f,S=this.state.fillStyle;r.backgroundFill&&(this.state.fillStyle=_.bL,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([l.DRAW_IMAGE,a,u,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[x,x],NaN,this.declutterMode_,this.declutterImageWithText_,c,!!r.backgroundFill,!!r.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?_.bL:this.fillKey_,this.textOffsetX_,this.textOffsetY_,s]),r.backgroundFill&&(this.state.fillStyle=S,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(e)}}saveTextStates_(){let t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,s=this.strokeKey_;!t||s in this.strokeStates||(this.strokeStates[s]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash});let l=this.textKey_;l in this.textStates||(this.textStates[l]={font:e.font,textAlign:e.textAlign||_.PH,justify:e.justify,textBaseline:e.textBaseline||_.ru,scale:e.scale});let n=this.fillKey_;!i||n in this.fillStates||(this.fillStates[n]={fillStyle:i.fillStyle})}drawChars_(t,e){let i=this.textStrokeState_,s=this.textState_,n=this.strokeKey_,r=this.textKey_,o=this.fillKey_;this.saveTextStates_();let a=this.pixelRatio,h=I[s.textBaseline],d=this.textOffsetY_*a,g=this.text_,u=i?i.lineWidth*Math.abs(s.scale[0])/2:0;this.instructions.push([l.DRAW_CHARS,t,e,h,s.overflow,o,s.maxAngle,a,d,n,u*a,g,r,1,this.declutterMode_]),this.hitDetectionInstructions.push([l.DRAW_CHARS,t,e,h,s.overflow,o?_.bL:o,s.maxAngle,a,d,n,u*a,g,r,1/a,this.declutterMode_])}setTextStyle(t,e){let i,s,l;if(t){let e=t.getFill();e?((s=this.textFillState_)||(s={},this.textFillState_=s),s.fillStyle=(0,g.y)(e.getColor()||_.bL)):(s=null,this.textFillState_=s);let n=t.getStroke();if(n){(l=this.textStrokeState_)||(l={},this.textStrokeState_=l);let t=n.getLineDash(),e=n.getLineDashOffset(),i=n.getWidth(),s=n.getMiterLimit();l.lineCap=n.getLineCap()||_.mb,l.lineDash=t?t.slice():_.X9,l.lineDashOffset=void 0===e?_.He:e,l.lineJoin=n.getLineJoin()||_.rc,l.lineWidth=void 0===i?_.yC:i,l.miterLimit=void 0===s?_.V4:s,l.strokeStyle=(0,g.y)(n.getColor()||_.Tx)}else l=null,this.textStrokeState_=l;i=this.textState_;let r=t.getFont()||_.Df;(0,_.Qx)(r);let o=t.getScaleArray();i.overflow=t.getOverflow(),i.font=r,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.repeat=t.getRepeat(),i.justify=t.getJustify(),i.textBaseline=t.getTextBaseline()||_.ru,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||_.oB,i.scale=void 0===o?[1,1]:o;let a=t.getOffsetX(),h=t.getOffsetY(),d=t.getRotateWithView(),u=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=void 0===a?0:a,this.textOffsetY_=void 0===h?0:h,this.textRotateWithView_=void 0!==d&&d,this.textRotation_=void 0===u?0:u,this.strokeKey_=l?("string"==typeof l.strokeStyle?l.strokeStyle:(0,C.sq)(l.strokeStyle))+l.lineCap+l.lineDashOffset+"|"+l.lineWidth+l.lineJoin+l.miterLimit+"["+l.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=s&&s.fillStyle?"string"==typeof s.fillStyle?s.fillStyle:"|"+(0,C.sq)(s.fillStyle):""}else this.text_="";this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}};let v={Circle:y,Default:x,Image:S,LineString:p,Polygon:y,Text:k};var R=class{constructor(t,e,i,s){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=s,this.resolution_=i,this.buildersByZIndex_={}}finish(){let t={};for(let e in this.buildersByZIndex_){t[e]=t[e]||{};let i=this.buildersByZIndex_[e];for(let s in i){let l=i[s].finish();t[e][s]=l}}return t}getBuilder(t,e){let i=void 0!==t?t.toString():"0",s=this.buildersByZIndex_[i];void 0===s&&(s={},this.buildersByZIndex_[i]=s);let l=s[e];if(void 0===l){let t=v[e];l=new t(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),s[e]=l}return l}},w=i(7581),L=i(6450),D=i(6101),E=i(6442),b=i(7374);let F=(0,u.lJ)(),M=[],O=[],P=[],W=[];function A(t){return t[3].declutterBox}let G=RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function B(t,e){return"start"===e?e=G.test(t)?"right":"left":"end"===e&&(e=G.test(t)?"left":"right"),I[e]}function Y(t,e,i){return i>0&&t.push("\n",""),t.push(e,""),t}var Z=class{constructor(t,e,i,s,l){this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.alignAndScaleFill_,this.instructions=s.instructions,this.coordinates=s.coordinates,this.coordinateCache_={},this.renderedTransform_=(0,D.Ue)(),this.hitDetectionInstructions=s.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=s.fillStates||{},this.strokeStates=s.strokeStates||{},this.textStates=s.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=l?new L.Z:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,e,i,s){let l;let n=t+e+i+s;if(this.labels_[n])return this.labels_[n];let r=s?this.strokeStates[s]:null,o=i?this.fillStates[i]:null,a=this.textStates[e],h=this.pixelRatio,d=[a.scale[0]*h,a.scale[1]*h],g=a.justify?I[a.justify]:B(Array.isArray(t)?t[0]:t,a.textAlign||_.PH),u=s&&r.lineWidth?r.lineWidth:0,c=Array.isArray(t)?t:String(t).split("\n").reduce(Y,[]),{width:f,height:x,widths:S,heights:p,lineWidths:m}=(0,_.Zw)(a,c),y=f+u,C=[],T=(y+2)*d[0],k=(x+u)*d[1],v={width:T<0?Math.floor(T):Math.ceil(T),height:k<0?Math.floor(k):Math.ceil(k),contextInstructions:C};(1!=d[0]||1!=d[1])&&C.push("scale",d),s&&(C.push("strokeStyle",r.strokeStyle),C.push("lineWidth",u),C.push("lineCap",r.lineCap),C.push("lineJoin",r.lineJoin),C.push("miterLimit",r.miterLimit),C.push("setLineDash",[r.lineDash]),C.push("lineDashOffset",r.lineDashOffset)),i&&C.push("fillStyle",o.fillStyle),C.push("textBaseline","middle"),C.push("textAlign","center");let R=.5-g,w=g*y+R*u,L=[],D=[],E=0,b=0,F=0,M=0;for(let t=0,e=c.length;t<e;t+=2){let e=c[t];if("\n"===e){b+=E,E=0,w=g*y+R*u,++M;continue}let n=c[t+1]||a.font;n!==l&&(s&&L.push("font",n),i&&D.push("font",n),l=n),E=Math.max(E,p[F]);let r=[e,w+R*S[F]+g*(S[F]-m[M]),.5*(u+E)+b];w+=S[F],s&&L.push("strokeText",r),i&&D.push("fillText",r),++F}return Array.prototype.push.apply(C,L),Array.prototype.push.apply(C,D),this.labels_[n]=v,v}replayTextBackground_(t,e,i,s,l,n,r){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,s),t.lineTo.apply(t,l),t.lineTo.apply(t,e),n&&(this.alignAndScaleFill_=n[2],this.fill_(t)),r&&(this.setStrokeStyle_(t,r),t.stroke())}calculateImageOrLabelDimensions_(t,e,i,s,l,n,r,o,a,h,d,g,_,c,f,x){let S;r*=g[0],o*=g[1];let p=i-r,m=s-o,y=l+a>t?t-a:l,C=n+h>e?e-h:n,T=c[3]+y*g[0]+c[1],I=c[0]+C*g[1]+c[2],k=p-c[3],v=m-c[0];return(f||0!==d)&&(M[0]=k,W[0]=k,M[1]=v,O[1]=v,O[0]=k+T,P[0]=O[0],P[1]=v+I,W[1]=P[1]),0!==d?(S=(0,D.qC)((0,D.Ue)(),i,s,1,1,d,-i,-s),(0,D.nn)(S,M),(0,D.nn)(S,O),(0,D.nn)(S,P),(0,D.nn)(S,W),(0,u.T9)(Math.min(M[0],O[0],P[0],W[0]),Math.min(M[1],O[1],P[1],W[1]),Math.max(M[0],O[0],P[0],W[0]),Math.max(M[1],O[1],P[1],W[1]),F)):(0,u.T9)(Math.min(k,k+T),Math.min(v,v+I),Math.max(k,k+T),Math.max(v,v+I),F),_&&(p=Math.round(p),m=Math.round(m)),{drawImageX:p,drawImageY:m,drawImageW:y,drawImageH:C,originX:a,originY:h,declutterBox:{minX:F[0],minY:F[1],maxX:F[2],maxY:F[3],value:x},canvasTransform:S,scale:g}}replayImageOrLabel_(t,e,i,s,l,n,r){let o=s.declutterBox,a=r?r[2]*s.scale[0]/2:0,h=o.minX-a<=e[0]&&o.maxX+a>=0&&o.minY-a<=e[1]&&o.maxY+a>=0;return h&&((n||r)&&this.replayTextBackground_(t,M,O,P,W,n,r),(0,_._f)(t,s.canvasTransform,l,i,s.originX,s.originY,s.drawImageW,s.drawImageH,s.drawImageX,s.drawImageY,s.scale)),!0}fill_(t){let e=this.alignAndScaleFill_;if(e){let i=(0,D.nn)(this.renderedTransform_,[0,0]),s=512*this.pixelRatio;t.save(),t.translate(i[0]%s,i[1]%s),1!==e&&t.scale(e,e),t.rotate(this.viewRotation_)}t.fill(),e&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,i,s){let l=this.textStates[e],n=this.createLabel(t,e,s,i),r=this.strokeStates[i],o=this.pixelRatio,a=B(Array.isArray(t)?t[0]:t,l.textAlign||_.PH),h=I[l.textBaseline||_.ru],d=r&&r.lineWidth?r.lineWidth:0,g=n.width/o-2*l.scale[0],u=h*n.height/o+2*(.5-h)*d;return{label:n,anchorX:a*g+2*(.5-a)*d,anchorY:u}}execute_(t,e,i,s,n,r,o,a){let h,d,g,f,x,S,p,m,y,C,I,k,v,R,w,L,F,M;let O=this.zIndexContext_;this.pixelCoordinates_&&(0,c.fS)(i,this.renderedTransform_)?h=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),h=(0,E.vT)(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),(0,D.lk)(this.renderedTransform_,i));let P=0,W=s.length,G=0,Y=0,Z=0,X=null,N=null,H=this.coordinateCache_,K=this.viewRotation_,J=Math.round(1e12*Math.atan2(-i[1],i[0]))/1e12,V={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:K},q=this.instructions!=s||this.overlaps?0:200;for(;P<W;){let i=s[P],c=i[0];switch(c){case l.BEGIN_GEOMETRY:w=i[1],M=i[3],w.getGeometry()?void 0===o||(0,u.kK)(o,M.getExtent())?++P:P=i[2]+1:P=i[2],O&&(O.zIndex=i[4]);break;case l.BEGIN_PATH:Y>q&&(this.fill_(t),Y=0),Z>q&&(t.stroke(),Z=0),Y||Z||(t.beginPath(),S=NaN,p=NaN),++P;break;case l.CIRCLE:G=i[1];let D=h[G],W=h[G+1],j=h[G+2],U=h[G+3],z=j-D,Q=U-W,$=Math.sqrt(z*z+Q*Q);t.moveTo(D+$,W),t.arc(D,W,$,0,2*Math.PI,!0),++P;break;case l.CLOSE_PATH:t.closePath(),++P;break;case l.CUSTOM:G=i[1],d=i[2];let tt=i[3],te=i[4],ti=i[5];V.geometry=tt,V.feature=w,P in H||(H[P]=[]);let ts=H[P];ti?ti(h,G,d,2,ts):(ts[0]=h[G],ts[1]=h[G+1],ts.length=2),O&&(O.zIndex=i[6]),te(ts,V),++P;break;case l.DRAW_IMAGE:let tl,tn,tr,to;G=i[1],d=i[2],C=i[3],g=i[4],f=i[5];let ta=i[6],th=i[7],td=i[8],tg=i[9],tu=i[10],t_=i[11],tc=i[12],tf=i[13];x=i[14]||"declutter";let tx=i[15];if(!C&&i.length>=20){I=i[19],k=i[20],v=i[21],R=i[22];let t=this.drawLabelWithPointPlacement_(I,k,v,R);C=t.label,i[3]=C;let e=i[23];g=(t.anchorX-e)*this.pixelRatio,i[4]=g;let s=i[24];f=(t.anchorY-s)*this.pixelRatio,i[5]=f,ta=C.height,i[6]=ta,tf=C.width,i[13]=tf}i.length>25&&(tl=i[25]),i.length>17?(tn=i[16],tr=i[17],to=i[18]):(tn=_.oB,tr=!1,to=!1),tu&&J?t_+=K:tu||J||(t_-=K);let tS=0;for(;G<d;G+=2){if(tl&&tl[tS++]<tf/this.pixelRatio)continue;let i=this.calculateImageOrLabelDimensions_(C.width,C.height,h[G],h[G+1],tf,ta,g,f,td,tg,t_,tc,n,tn,tr||to,w),s=[t,e,C,i,th,tr?X:null,to?N:null];if(a){let t,e,l,n,r;if(tx){let i=d-G;if(!tx[i]){tx[i]={args:s,declutterMode:x};continue}let n=tx[i];t=n.args,e=n.declutterMode,delete tx[i],l=A(t)}if(t&&("declutter"!==e||!a.collides(l))&&(n=!0),"declutter"===x&&a.collides(i.declutterBox)||(r=!0),"declutter"===e&&"declutter"===x){let t=n&&r;n=t,r=t}n&&("none"!==e&&a.insert(l),this.replayImageOrLabel_.apply(this,t)),r&&("none"!==x&&a.insert(i.declutterBox),this.replayImageOrLabel_.apply(this,s))}else this.replayImageOrLabel_.apply(this,s)}++P;break;case l.DRAW_CHARS:let tp;let tm=i[1],ty=i[2],tC=i[3],tT=i[4];R=i[5];let tI=i[6],tk=i[7],tv=i[8];v=i[9];let tR=i[10];I=i[11],k=i[12];let tw=[i[13],i[13]];x=i[14]||"declutter";let tL=this.textStates[k],tD=tL.font,tE=[tL.scale[0]*tk,tL.scale[1]*tk];tD in this.widths_?tp=this.widths_[tD]:(tp={},this.widths_[tD]=tp);let tb=(0,b.W)(h,tm,ty,2),tF=Math.abs(tE[0])*(0,_.Kd)(tD,I,tp);if(tT||tF<=tb){let i=this.textStates[k].textAlign,s=(tb-tF)*B(I,i),l=function(t,e,i,s,l,n,r,o,a,h,d,g){let u,_,c=t[e],f=t[e+1],x=0,S=0,p=0,m=0;function y(){x=c,S=f,e+=s,c=t[e],f=t[e+1],m+=p,p=Math.sqrt((c-x)*(c-x)+(f-S)*(f-S))}do y();while(e<i-s&&m+p<n);let C=0===p?0:(n-m)/p,I=(0,T.t7)(x,c,C),k=(0,T.t7)(S,f,C),v=e-s,R=m,w=n+o*a(h,l,d);for(;e<i-s&&m+p<w;)y();C=0===p?0:(w-m)/p;let L=(0,T.t7)(x,c,C),D=(0,T.t7)(S,f,C);if(g){let t=[I,k,L,D];(0,E.U1)(t,0,4,2,g,t,t),u=t[0]>t[2]}else u=I>L;let b=Math.PI,F=[],M=v+s===e;if(e=v,p=0,m=R,c=t[e],f=t[e+1],M)return y(),_=Math.atan2(f-S,c-x),u&&(_+=_>0?-b:b),F[0]=[(L+I)/2,(D+k)/2,(w-n)/2,_,l],F;l=l.replace(/\n/g," ");for(let t=0,g=l.length;t<g;){y();let I=Math.atan2(f-S,c-x);if(u&&(I+=I>0?-b:b),void 0!==_){let t=I-_;if(Math.abs(t+=t>b?-2*b:t<-b?2*b:0)>r)return null}_=I;let k=t,v=0;for(;t<g;++t){let r=u?g-t-1:t,_=o*a(h,l[r],d);if(e+s<i&&m+p<n+v+_/2)break;v+=_}if(t===k)continue;let R=u?l.substring(g-k,g-t):l.substring(k,t);C=0===p?0:(n+v/2-m)/p;let w=(0,T.t7)(x,c,C),L=(0,T.t7)(S,f,C);F.push([w,L,v/2,I,R]),n+=v}return F}(h,tm,ty,2,I,s,tI,Math.abs(tE[0]),_.Kd,tD,tp,J?0:this.viewRotation_);t:if(l){let i,s,n,r,o;let h=[];if(v)for(i=0,s=l.length;i<s;++i){n=(o=l[i])[4],r=this.createLabel(n,k,"",v),g=o[2]+(tE[0]<0?-tR:tR),f=tC*r.height+(.5-tC)*2*tR*tE[1]/tE[0]-tv;let s=this.calculateImageOrLabelDimensions_(r.width,r.height,o[0],o[1],r.width,r.height,g,f,0,0,o[3],tw,!1,_.oB,!1,w);if(a&&"declutter"===x&&a.collides(s.declutterBox))break t;h.push([t,e,r,s,1,null,null])}if(R)for(i=0,s=l.length;i<s;++i){n=(o=l[i])[4],r=this.createLabel(n,k,R,""),g=o[2],f=tC*r.height-tv;let s=this.calculateImageOrLabelDimensions_(r.width,r.height,o[0],o[1],r.width,r.height,g,f,0,0,o[3],tw,!1,_.oB,!1,w);if(a&&"declutter"===x&&a.collides(s.declutterBox))break t;h.push([t,e,r,s,1,null,null])}a&&"none"!==x&&a.load(h.map(A));for(let t=0,e=h.length;t<e;++t)this.replayImageOrLabel_.apply(this,h[t])}}++P;break;case l.END_GEOMETRY:if(void 0!==r){w=i[1];let t=r(w,M,x);if(t)return t}++P;break;case l.FILL:q?Y++:this.fill_(t),++P;break;case l.MOVE_TO_LINE_TO:for(G=i[1],d=i[2],L=h[G],F=h[G+1],t.moveTo(L,F),S=L+.5|0,p=F+.5|0,G+=2;G<d;G+=2)L=h[G],F=h[G+1],m=L+.5|0,y=F+.5|0,(G==d-2||m!==S||y!==p)&&(t.lineTo(L,F),S=m,p=y);++P;break;case l.SET_FILL_STYLE:X=i,this.alignAndScaleFill_=i[2],Y&&(this.fill_(t),Y=0,Z&&(t.stroke(),Z=0)),t.fillStyle=i[1],++P;break;case l.SET_STROKE_STYLE:N=i,Z&&(t.stroke(),Z=0),this.setStrokeStyle_(t,i),++P;break;case l.STROKE:q?Z++:t.stroke(),++P;break;default:++P}}Y&&this.fill_(t),Z&&t.stroke()}execute(t,e,i,s,l,n){this.viewRotation_=s,this.execute_(t,e,i,this.instructions,l,void 0,void 0,n)}executeHitDetection(t,e,i,s,l){return this.viewRotation_=i,this.execute_(t,[t.canvas.width,t.canvas.height],e,this.hitDetectionInstructions,!0,s,l)}},X=i(8326),N=i(9374);let H=["Polygon","Circle","LineString","Image","Text","Default"],K=["Image","Text"],J=H.filter(t=>!K.includes(t)),V={};var q=class{constructor(t,e,i,s,l,n,r){this.maxExtent_=t,this.overlaps_=s,this.pixelRatio_=i,this.resolution_=e,this.renderBuffer_=n,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=(0,D.Ue)(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(l,r)}clip(t,e){let i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()}createExecutors_(t,e){for(let i in t){let s=this.executorsByZIndex_[i];void 0===s&&(s={},this.executorsByZIndex_[i]=s);let l=t[i];for(let t in l){let i=l[t];s[t]=new Z(this.resolution_,this.pixelRatio_,this.overlaps_,i,e)}}}hasExecutors(t){for(let e in this.executorsByZIndex_){let i=this.executorsByZIndex_[e];for(let e=0,s=t.length;e<s;++e)if(t[e]in i)return!0}return!1}forEachFeatureAtCoordinate(t,e,i,s,l,n){let r,o,a,h,d,g,_;s=Math.round(s);let f=2*s+1,x=(0,D.qC)(this.hitDetectionTransform_,s+.5,s+.5,1/e,-1/e,-i,-t[0],-t[1]),S=!this.hitDetectionContext_;S&&(this.hitDetectionContext_=(0,X.E4)(f,f,void 0,{willReadFrequently:!0}));let p=this.hitDetectionContext_;p.canvas.width!==f||p.canvas.height!==f?(p.canvas.width=f,p.canvas.height=f):S||p.clearRect(0,0,f,f),void 0!==this.renderBuffer_&&(r=(0,u.lJ)(),(0,u.Wj)(r,t),(0,u.f3)(r,e*(this.renderBuffer_+s),r));let m=function(t){if(void 0!==V[t])return V[t];let e=2*t+1,i=t*t,s=Array(i+1);for(let l=0;l<=t;++l)for(let n=0;n<=t;++n){let r=l*l+n*n;if(r>i)break;let o=s[r];o||(o=[],s[r]=o),o.push(((t+l)*e+(t+n))*4+3),l>0&&o.push(((t-l)*e+(t+n))*4+3),n>0&&(o.push(((t+l)*e+(t-n))*4+3),l>0&&o.push(((t-l)*e+(t-n))*4+3))}let l=[];for(let t=0,e=s.length;t<e;++t)s[t]&&l.push(...s[t]);return V[t]=l,l}(s);function y(t,e,i){let r=p.getImageData(0,0,f,f).data;for(let a=0,h=m.length;a<h;a++)if(r[m[a]]>0){if(!n||"none"===i||"Image"!==o&&"Text"!==o||n.includes(t)){let i=(m[a]-3)/4,n=s-i%f,r=s-(i/f|0),o=l(t,e,n*n+r*r);if(o)return o}p.clearRect(0,0,f,f);break}}let C=Object.keys(this.executorsByZIndex_).map(Number);for(C.sort(c.j2),a=C.length-1;a>=0;--a){let t=C[a].toString();for(d=this.executorsByZIndex_[t],h=H.length-1;h>=0;--h)if(void 0!==(g=d[o=H[h]])&&(_=g.executeHitDetection(p,x,i,y,r)))return _}}getClipCoords(t){let e=this.maxExtent_;if(!e)return null;let i=e[0],s=e[1],l=e[2],n=e[3],r=[i,s,i,n,l,n,l,s];return(0,E.vT)(r,0,8,2,t,r),r}isEmpty(){return(0,N.x)(this.executorsByZIndex_)}execute(t,e,i,s,l,n,r){let o,a,h,d,g;let u=Object.keys(this.executorsByZIndex_).map(Number);u.sort(c.j2),n=n||H;let _=H.length;for(r&&u.reverse(),o=0,a=u.length;o<a;++o){let a=u[o].toString();for(h=0,g=this.executorsByZIndex_[a],d=n.length;h<d;++h){let a=n[h],d=g[a];if(void 0!==d){let n=null===r?void 0:d.getZIndexContext(),g=n?n.getContext():t,c=this.maxExtent_&&"Image"!==a&&"Text"!==a;if(c&&(g.save(),this.clip(g,i)),n&&"Text"!==a&&"Image"!==a?n.pushFunction(t=>d.execute(t,e,i,s,l,r)):d.execute(g,e,i,s,l,r),c&&g.restore(),n){n.offset();let t=u[o]*_+h;this.deferredZIndexContexts_[t]||(this.deferredZIndexContexts_[t]=[]),this.deferredZIndexContexts_[t].push(n)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){let t=this.deferredZIndexContexts_,e=Object.keys(t).map(Number).sort(c.j2);for(let i=0,s=e.length;i<s;++i)t[e[i]].forEach(t=>{t.draw(this.renderedContext_),t.clear()}),t[e[i]].length=0}},j=i(8771),U=i(7755),z=i(2967),Q=class extends d{constructor(t,e,i,s,l,n,r){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=s,this.transformRotation_=s?(0,T.FH)(Math.atan2(s[1],s[0]),10):0,this.viewRotation_=l,this.squaredTolerance_=n,this.userTransform_=r,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=(0,D.Ue)()}drawImages_(t,e,i,s){if(!this.image_)return;let l=(0,E.vT)(t,e,i,s,this.transform_,this.pixelCoordinates_),n=this.context_,r=this.tmpLocalTransform_,o=n.globalAlpha;1!=this.imageOpacity_&&(n.globalAlpha=o*this.imageOpacity_);let a=this.imageRotation_;0===this.transformRotation_&&(a-=this.viewRotation_),this.imageRotateWithView_&&(a+=this.viewRotation_);for(let t=0,e=l.length;t<e;t+=2){let e=l[t]-this.imageAnchorX_,i=l[t+1]-this.imageAnchorY_;if(0!==a||1!=this.imageScale_[0]||1!=this.imageScale_[1]){let t=e+this.imageAnchorX_,s=i+this.imageAnchorY_;(0,D.qC)(r,t,s,1,1,a,-t,-s),n.save(),n.transform.apply(n,r),n.translate(t,s),n.scale(this.imageScale_[0],this.imageScale_[1]),n.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),n.restore()}else n.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,e,i,this.imageWidth_,this.imageHeight_)}1!=this.imageOpacity_&&(n.globalAlpha=o)}drawText_(t,e,i,s){if(!this.textState_||""===this.text_)return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);let l=(0,E.vT)(t,e,i,s,this.transform_,this.pixelCoordinates_),n=this.context_,r=this.textRotation_;for(0===this.transformRotation_&&(r-=this.viewRotation_),this.textRotateWithView_&&(r+=this.viewRotation_);e<i;e+=s){let t=l[e]+this.textOffsetX_,i=l[e+1]+this.textOffsetY_;0!==r||1!=this.textScale_[0]||1!=this.textScale_[1]?(n.save(),n.translate(t-this.textOffsetX_,i-this.textOffsetY_),n.rotate(r),n.translate(this.textOffsetX_,this.textOffsetY_),n.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&n.strokeText(this.text_,0,0),this.textFillState_&&n.fillText(this.text_,0,0),n.restore()):(this.textStrokeState_&&n.strokeText(this.text_,t,i),this.textFillState_&&n.fillText(this.text_,t,i))}}moveToLineTo_(t,e,i,s,l){let n=this.context_,r=(0,E.vT)(t,e,i,s,this.transform_,this.pixelCoordinates_);n.moveTo(r[0],r[1]);let o=r.length;l&&(o-=2);for(let t=2;t<o;t+=2)n.lineTo(r[t],r[t+1]);return l&&n.closePath(),i}drawRings_(t,e,i,s){for(let l=0,n=i.length;l<n;++l)e=this.moveToLineTo_(t,e,i[l],s,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),(0,u.kK)(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);let e=(0,z.Kr)(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],s=e[3]-e[1],l=this.context_;l.beginPath(),l.arc(e[0],e[1],Math.sqrt(i*i+s*s),0,2*Math.PI),this.fillState_&&l.fill(),this.strokeState_&&l.stroke()}""!==this.text_&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){let e=t.getType();switch(e){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t)}}drawFeature(t,e){let i=e.getGeometryFunction()(t);i&&(this.setStyle(e),this.drawGeometry(i))}drawGeometryCollection(t){let e=t.getGeometriesArray();for(let t=0,i=e.length;t<i;++t)this.drawGeometry(e[t])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));let e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),""!==this.text_&&this.drawText_(e,0,e.length,i)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));let e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),""!==this.text_&&this.drawText_(e,0,e.length,i)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),(0,u.kK)(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);let e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(""!==this.text_){let e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));let e=t.getExtent();if((0,u.kK)(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);let e=this.context_,i=t.getFlatCoordinates(),s=0,l=t.getEnds(),n=t.getStride();e.beginPath();for(let t=0,e=l.length;t<e;++t)s=this.moveToLineTo_(i,s,l[t],n,!1);e.stroke()}if(""!==this.text_){let e=t.getFlatMidpoints();this.drawText_(e,0,e.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),(0,u.kK)(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);let e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){let e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),(0,u.kK)(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);let e=this.context_,i=t.getOrientedFlatCoordinates(),s=0,l=t.getEndss(),n=t.getStride();e.beginPath();for(let t=0,e=l.length;t<e;++t){let e=l[t];s=this.drawRings_(i,s,e,n)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){let e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){let e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){let e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),(0,c.fS)(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){let e=this.context_,i=this.contextTextState_,s=t.textAlign?t.textAlign:_.PH;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=s&&(i.textAlign=s,e.textAlign=s),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=s,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:s,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(t){let e=t.getColor();this.fillState_={fillStyle:(0,g.y)(e||_.bL)}}else this.fillState_=null;if(e){let t=e.getColor(),i=e.getLineCap(),s=e.getLineDash(),l=e.getLineDashOffset(),n=e.getLineJoin(),r=e.getWidth(),o=e.getMiterLimit(),a=s||_.X9;this.strokeState_={lineCap:void 0!==i?i:_.mb,lineDash:1===this.pixelRatio_?a:a.map(t=>t*this.pixelRatio_),lineDashOffset:(l||_.He)*this.pixelRatio_,lineJoin:void 0!==n?n:_.rc,lineWidth:(void 0!==r?r:_.yC)*this.pixelRatio_,miterLimit:void 0!==o?o:_.V4,strokeStyle:(0,g.y)(t||_.Tx)}}else this.strokeState_=null}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}let i=t.getPixelRatio(this.pixelRatio_),s=t.getAnchor(),l=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=s[0]*i,this.imageAnchorY_=s[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=l[0],this.imageOriginY_=l[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();let n=t.getScaleArray();this.imageScale_=[n[0]*this.pixelRatio_/i,n[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i}setTextStyle(t){if(t){let e=t.getFill();if(e){let t=e.getColor();this.textFillState_={fillStyle:(0,g.y)(t||_.bL)}}else this.textFillState_=null;let i=t.getStroke();if(i){let t=i.getColor(),e=i.getLineCap(),s=i.getLineDash(),l=i.getLineDashOffset(),n=i.getLineJoin(),r=i.getWidth(),o=i.getMiterLimit();this.textStrokeState_={lineCap:void 0!==e?e:_.mb,lineDash:s||_.X9,lineDashOffset:l||_.He,lineJoin:void 0!==n?n:_.rc,lineWidth:void 0!==r?r:_.yC,miterLimit:void 0!==o?o:_.V4,strokeStyle:(0,g.y)(t||_.Tx)}}else this.textStrokeState_=null;let s=t.getFont(),l=t.getOffsetX(),n=t.getOffsetY(),r=t.getRotateWithView(),o=t.getRotation(),a=t.getScaleArray(),h=t.getText(),d=t.getTextAlign(),u=t.getTextBaseline();this.textState_={font:void 0!==s?s:_.Df,textAlign:void 0!==d?d:_.PH,textBaseline:void 0!==u?u:_.ru},this.text_=void 0!==h?Array.isArray(h)?h.reduce((t,e,i)=>t+=i%2?" ":e,""):h:"",this.textOffsetX_=void 0!==l?this.pixelRatio_*l:0,this.textOffsetY_=void 0!==n?this.pixelRatio_*n:0,this.textRotateWithView_=void 0!==r&&r,this.textRotation_=void 0!==o?o:0,this.textScale_=[this.pixelRatio_*a[0],this.pixelRatio_*a[1]]}else this.text_=""}},$=i(2370),tt=i(6835),te=i(553);let ti={Point:function(t,e,i,s,l,n){let r=i.getImage(),o=i.getText(),a=o&&o.getText(),h=n&&r&&a?{}:void 0;if(r){if(r.getImageState()!=te.Z.LOADED)return;let n=t.getBuilder(i.getZIndex(),"Image");n.setImageStyle(r,h),n.drawPoint(e,s,l)}if(a){let n=t.getBuilder(i.getZIndex(),"Text");n.setTextStyle(o,h),n.drawText(e,s,l)}},LineString:function(t,e,i,s,l){let n=i.getStroke();if(n){let r=t.getBuilder(i.getZIndex(),"LineString");r.setFillStrokeStyle(null,n),r.drawLineString(e,s,l)}let r=i.getText();if(r&&r.getText()){let n=t.getBuilder(i.getZIndex(),"Text");n.setTextStyle(r),n.drawText(e,s,l)}},Polygon:function(t,e,i,s,l){let n=i.getFill(),r=i.getStroke();if(n||r){let o=t.getBuilder(i.getZIndex(),"Polygon");o.setFillStrokeStyle(n,r),o.drawPolygon(e,s,l)}let o=i.getText();if(o&&o.getText()){let n=t.getBuilder(i.getZIndex(),"Text");n.setTextStyle(o),n.drawText(e,s,l)}},MultiPoint:function(t,e,i,s,l,n){let r=i.getImage(),o=r&&0!==r.getOpacity(),a=i.getText(),h=a&&a.getText(),d=n&&o&&h?{}:void 0;if(o){if(r.getImageState()!=te.Z.LOADED)return;let n=t.getBuilder(i.getZIndex(),"Image");n.setImageStyle(r,d),n.drawMultiPoint(e,s,l)}if(h){let n=t.getBuilder(i.getZIndex(),"Text");n.setTextStyle(a,d),n.drawText(e,s,l)}},MultiLineString:function(t,e,i,s,l){let n=i.getStroke();if(n){let r=t.getBuilder(i.getZIndex(),"LineString");r.setFillStrokeStyle(null,n),r.drawMultiLineString(e,s,l)}let r=i.getText();if(r&&r.getText()){let n=t.getBuilder(i.getZIndex(),"Text");n.setTextStyle(r),n.drawText(e,s,l)}},MultiPolygon:function(t,e,i,s,l){let n=i.getFill(),r=i.getStroke();if(r||n){let o=t.getBuilder(i.getZIndex(),"Polygon");o.setFillStrokeStyle(n,r),o.drawMultiPolygon(e,s,l)}let o=i.getText();if(o&&o.getText()){let n=t.getBuilder(i.getZIndex(),"Text");n.setTextStyle(o),n.drawText(e,s,l)}},GeometryCollection:function(t,e,i,s,l,n){let r,o;let a=e.getGeometriesArray();for(r=0,o=a.length;r<o;++r){let e=ti[a[r].getType()];e(t,a[r],i,s,l,n)}},Circle:function(t,e,i,s,l){let n=i.getFill(),r=i.getStroke();if(n||r){let o=t.getBuilder(i.getZIndex(),"Circle");o.setFillStrokeStyle(n,r),o.drawCircle(e,s,l)}let o=i.getText();if(o&&o.getText()){let l=t.getBuilder(i.getZIndex(),"Text");l.setTextStyle(o),l.drawText(e,s)}}};function ts(t,e){return parseInt((0,C.sq)(t),10)-parseInt((0,C.sq)(e),10)}function tl(t,e){let i=.5*t/e;return i*i}function tn(t,e,i,s,l,n,r,o){let a=[],h=i.getImage();if(h){let t=!0,e=h.getImageState();e==te.Z.LOADED||e==te.Z.ERROR?t=!1:e==te.Z.IDLE&&h.load(),t&&a.push(h.ready())}let d=i.getFill();d&&d.loading()&&a.push(d.ready());let g=a.length>0;return g&&Promise.all(a).then(()=>l(null)),function(t,e,i,s,l,n,r){let o=i.getGeometryFunction()(e);if(!o)return;let a=o.simplifyTransformed(s,l),h=i.getRenderer();if(h)(function t(e,i,s,l,n){if("GeometryCollection"==i.getType()){let r=i.getGeometries();for(let i=0,o=r.length;i<o;++i)t(e,r[i],s,l,n);return}let r=e.getBuilder(s.getZIndex(),"Default");r.drawCustom(i,l,s.getRenderer(),s.getHitDetectionRenderer(),n)})(t,a,i,e,r);else{let s=ti[a.getType()];s(t,a,i,e,r,n)}}(t,e,i,s,n,r,o),g}var tr=i(9006);class to extends w.Z{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=(0,u.lJ)(),this.wrappedRenderedExtent_=(0,u.lJ)(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(t,e,i){let s=e.extent,l=e.viewState,n=l.center,r=l.resolution,o=l.projection,a=l.rotation,h=o.getExtent(),d=this.getLayer().getSource(),g=this.getLayer().getDeclutter(),_=e.pixelRatio,c=e.viewHints,f=!(c[U.Z.ANIMATING]||c[U.Z.INTERACTING]),x=this.context,S=Math.round((0,u.dz)(s)/r*_),p=Math.round((0,u.Cr)(s)/r*_),m=d.getWrapX()&&o.canWrapX(),y=m?(0,u.dz)(h):null,C=m?Math.ceil((s[2]-h[2])/y)+1:1,T=m?Math.floor((s[0]-h[0])/y):0;do{let s=this.getRenderTransform(n,r,0,_,S,p,T*y);e.declutter&&(s=s.slice(0)),t.execute(x,[x.canvas.width,x.canvas.height],s,a,f,void 0===i?H:i?K:J,i?g&&e.declutter[g]:void 0)}while(++T<C)}setDrawContext_(){1!==this.opacity_&&(this.targetContext_=this.context,this.context=(0,X.E4)(this.context.canvas.width,this.context.canvas.height,w.r))}resetDrawContext_(){if(1!==this.opacity_){let t=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=t,(0,X.jy)(this.context),w.r.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(t){this.replayGroup_&&this.getLayer().getDeclutter()&&this.renderWorlds(this.replayGroup_,t,!0)}renderDeferredInternal(t){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(t,e){let i=t.layerStatesArray[t.layerIndex];this.opacity_=i.opacity;let s=t.viewState;this.prepareContainer(t,e);let l=this.context,n=this.replayGroup_,r=n&&!n.isEmpty();if(!r){let t=this.getLayer().hasListener(j.Z.PRERENDER)||this.getLayer().hasListener(j.Z.POSTRENDER);if(!t)return null}this.setDrawContext_(),this.preRender(l,t);let o=s.projection;if(this.clipped_=!1,r&&i.extent&&this.clipping){let e=(0,tt.dY)(i.extent,o);r=(0,u.kK)(e,t.extent),this.clipped_=r&&!(0,u.r4)(e,t.extent),this.clipped_&&this.clipUnrotated(l,t,e)}return r&&this.renderWorlds(n,t,!this.getLayer().getDeclutter()&&void 0),!t.declutter&&this.clipped_&&l.restore(),this.postRender(l,t),this.renderedRotation_!==s.rotation&&(this.renderedRotation_=s.rotation,this.hitDetectionImageData_=null),t.declutter||this.resetDrawContext_(),this.container}getFeatures(t){return new Promise(e=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){let t=this.frameState.size.slice(),e=this.renderedCenter_,i=this.renderedResolution_,s=this.renderedRotation_,l=this.renderedProjection_,n=this.wrappedRenderedExtent_,r=this.getLayer(),o=[],a=.5*t[0],h=.5*t[1];o.push(this.getRenderTransform(e,i,s,.5,a,h,0).slice());let d=r.getSource(),g=l.getExtent();if(d.getWrapX()&&l.canWrapX()&&!(0,u.r4)(g,n)){let t,l=n[0],r=(0,u.dz)(g),d=0;for(;l<g[0];)t=r*--d,o.push(this.getRenderTransform(e,i,s,.5,a,h,t).slice()),l+=r;for(d=0,l=n[2];l>g[2];)t=r*++d,o.push(this.getRenderTransform(e,i,s,.5,a,h,t).slice()),l-=r}let _=(0,tt.Cs)();this.hitDetectionImageData_=function(t,e,i,s,l,n,r,o,a){let h=a?(0,tt.Fj)(l,a):l,d=.5*t[0],g=.5*t[1],_=(0,X.E4)(d,g);_.imageSmoothingEnabled=!1;let f=_.canvas,x=new Q(_,.5,l,null,r,o,a?(0,tt.WO)((0,tt.Cs)(),a):null),S=i.length,p=Math.floor(16777215/S),m={};for(let t=1;t<=S;++t){let e=i[t-1],l=e.getStyleFunction()||s;if(!l)continue;let r=l(e,n);if(!r)continue;Array.isArray(r)||(r=[r]);let o=t*p,a=o.toString(16).padStart(7,"#00000");for(let t=0,i=r.length;t<i;++t){let i=r[t],s=i.getGeometryFunction()(e);if(!s||!(0,u.kK)(h,s.getExtent()))continue;let l=i.clone(),n=l.getFill();n&&n.setColor(a);let o=l.getStroke();o&&(o.setColor(a),o.setLineDash(null)),l.setText(void 0);let d=i.getImage();if(d){let t=d.getImageSize();if(!t)continue;let e=(0,X.E4)(t[0],t[1],void 0,{alpha:!1}),i=e.canvas;e.fillStyle=a,e.fillRect(0,0,i.width,i.height),l.setImage(new $.Z({img:i,anchor:d.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:d.getOrigin(),opacity:1,size:d.getSize(),scale:d.getScale(),rotation:d.getRotation(),rotateWithView:d.getRotateWithView()}))}let g=l.getZIndex()||0,_=m[g];_||(_={},m[g]=_,_.Polygon=[],_.Circle=[],_.LineString=[],_.Point=[]);let c=s.getType();if("GeometryCollection"===c){let t=s.getGeometriesArrayRecursive();for(let e=0,i=t.length;e<i;++e){let i=t[e];_[i.getType().replace("Multi","")].push(i,l)}}else _[c.replace("Multi","")].push(s,l)}}let y=Object.keys(m).map(Number).sort(c.j2);for(let t=0,i=y.length;t<i;++t){let i=m[y[t]];for(let t in i){let s=i[t];for(let t=0,i=s.length;t<i;t+=2){x.setStyle(s[t+1]);for(let i=0,l=e.length;i<l;++i)x.setTransform(e[i]),x.drawGeometry(s[t])}}}return _.getImageData(0,0,f.width,f.height)}(t,o,this.renderedFeatures_,r.getStyleFunction(),n,i,s,tl(i,this.renderedPixelRatio_),_?l:null)}e(function(t,e,i){let s=[];if(i){let l=Math.floor(.5*Math.round(t[0])),n=Math.floor(.5*Math.round(t[1])),r=((0,T.uZ)(l,0,i.width-1)+(0,T.uZ)(n,0,i.height-1)*i.width)*4,o=i.data[r],a=i.data[r+1],h=i.data[r+2],d=h+256*(a+256*o),g=Math.floor(16777215/e.length);d&&d%g==0&&s.push(e[d/g-1])}return s}(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,e,i,s,l){let n;if(!this.replayGroup_)return;let r=e.viewState.resolution,o=e.viewState.rotation,a=this.getLayer(),h={},d=function(t,e,i){let n=(0,C.sq)(t),r=h[n];if(r){if(!0!==r&&i<r.distanceSq){if(0===i)return h[n]=!0,l.splice(l.lastIndexOf(r),1),s(t,a,e);r.geometry=e,r.distanceSq=i}}else{if(0===i)return h[n]=!0,s(t,a,e);l.push(h[n]={feature:t,layer:a,geometry:e,distanceSq:i,callback:s})}},g=[this.replayGroup_],u=this.getLayer().getDeclutter();return g.some(s=>n=s.forEachFeatureAtCoordinate(t,r,o,i,d,u&&e.declutter[u]?e.declutter[u].all().map(t=>t.value):null)),n}handleFontsChanged(){let t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){let e;let i=this.getLayer(),s=i.getSource();if(!s)return!1;let l=t.viewHints[U.Z.ANIMATING],n=t.viewHints[U.Z.INTERACTING],r=i.getUpdateWhileAnimating(),o=i.getUpdateWhileInteracting();if(this.ready&&!r&&l||!o&&n)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;let a=t.extent,h=t.viewState,d=h.projection,g=h.resolution,_=t.pixelRatio,f=i.getRevision(),x=i.getRenderBuffer(),S=i.getRenderOrder();void 0===S&&(S=ts);let p=h.center.slice(),m=(0,u.f3)(a,x*g),y=m.slice(),C=[m.slice()],T=d.getExtent();if(s.getWrapX()&&d.canWrapX()&&!(0,u.r4)(T,t.extent)){let t=(0,u.dz)(T),e=Math.max((0,u.dz)(m)/2,t);m[0]=T[0]-e,m[2]=T[2]+e,(0,tr.Cf)(p,d);let i=(0,u.Cf)(C[0],d);i[0]<T[0]&&i[2]<T[2]?C.push([i[0]+t,i[1],i[2]+t,i[3]]):i[0]>T[0]&&i[2]>T[2]&&C.push([i[0]-t,i[1],i[2]-t,i[3]])}if(this.ready&&this.renderedResolution_==g&&this.renderedRevision_==f&&this.renderedRenderOrder_==S&&!!t.declutter===this.renderedFrameDeclutter_&&(0,u.r4)(this.wrappedRenderedExtent_,m))return(0,c.fS)(this.renderedExtent_,y)||(this.hitDetectionImageData_=null,this.renderedExtent_=y),this.renderedCenter_=p,this.replayGroupChanged=!1,!0;this.replayGroup_=null;let I=new R(.5*g/_,m,g,_),k=(0,tt.Cs)();if(k){for(let t=0,e=C.length;t<e;++t){let e=C[t],i=(0,tt.Fj)(e,d);s.loadFeatures(i,(0,tt.on)(g,d),k)}e=(0,tt.WO)(k,d)}else for(let t=0,e=C.length;t<e;++t)s.loadFeatures(C[t],g,d);let v=tl(g,_),w=!0,L=(t,s)=>{let l;let n=t.getStyleFunction()||i.getStyleFunction();if(n&&(l=n(t,g)),l){let i=this.renderFeature(t,v,l,I,e,this.getLayer().getDeclutter(),s);w=w&&!i}},D=(0,tt.Fj)(m,d),E=s.getFeaturesInExtent(D);S&&E.sort(S);for(let t=0,e=E.length;t<e;++t)L(E[t],t);this.renderedFeatures_=E,this.ready=w;let b=I.finish(),F=new q(m,g,_,s.getOverlaps(),b,i.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=g,this.renderedRevision_=f,this.renderedRenderOrder_=S,this.renderedFrameDeclutter_=!!t.declutter,this.renderedExtent_=y,this.wrappedRenderedExtent_=m,this.renderedCenter_=p,this.renderedProjection_=d,this.renderedPixelRatio_=_,this.replayGroup_=F,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,i,s,l,n,r){if(!i)return!1;let o=!1;if(Array.isArray(i))for(let a=0,h=i.length;a<h;++a)o=tn(s,t,i[a],e,this.boundHandleStyleImageChange_,l,n,r)||o;else o=tn(s,t,i,e,this.boundHandleStyleImageChange_,l,n,r);return o}}class ta extends s.Z{constructor(t){super(t)}createRenderer(){return new to(this)}}var th=ta}}]);